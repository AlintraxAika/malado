import streamlit as st
from datetime import date
import datetime
import math

bgmom = ""
rhmom = ""
momBlood = "XX"
bgnb = ""
rhnb = ""
nbBlood = "XX"
afu = 0
preec = False

def nDaysBetween (date1, date2):
	s1 = date1.split("/")
	s2 = date2.split("/")
	dateC1 = datetime.datetime(int(s1[2]),int(s1[1]),int(s1[0]))
	dateC2 = datetime.datetime(int(s2[2]),int(s2[1]),int(s2[0]))
	return abs((dateC2 - dateC1).days)

def igToDays (weeks, days):
	return days+weeks*7

def daysToIg (days):
	return [math.floor(days/7), days%7]

st.header("üìù EVOLU√á√ÉO DOM MALADO")
st.subheader("üêÅexclusive 4 ratchexüêÄ")
st.write("<todo texto inserido ser√° convertido para caixa alta>")

#QUESTIONAIRE
##ID + POINT-OF-CARE TESTS
name = st.text_input("NOME:")
c1, c2, c3, c4, c5, c6, c7, c8, c9 = st.columns([1.5,1,1,1,1,1.5,1.5,1.5,1.5])
with c1:
	age = st.text_input("IDADE:")
with c2:
	g = st.text_input("G:", value="1")
with c3:
	pv = st.text_input("PV:", value="0")
with c4:
	pc = st.text_input("PC:", value="0")
with c5:
	a = st.text_input("A:", value="0")
with c6:
	sif = st.checkbox("S√çFILIS")
with c7:
	hiv = st.checkbox("HIV")
with c8:
	hcv = st.checkbox("HCV")
with c9:
	hbs = st.checkbox("HbsAg")

##COMORBIDITIES
c1, c2, c3 = st.columns(3)
c4, c5 = st.columns(2)
with c1:
	dm = st.checkbox("DIABETES MELLITUS")
	if dm:
		with c4:
			dmType = st.radio("DM:", ["GESTACIONAL","TIPO 1", "TIPO 2"], key="radio0", horizontal=True)
with c2:
	crhyp = st.checkbox("HAS CR√îNICA")
with c3:
	gesthyp = st.checkbox("HAS GESTACIONAL")
if gesthyp:
	with c5:
		c6, c7 = st.columns(2)
		with c6:
			severePreec = st.checkbox("DETERIORA√á√ÉO")
		with c7:
			preec = st.checkbox("PR√â-ECL√ÇMPSIA", value=severePreec)

##MOTHER BLOOD TYPE
if st.checkbox("TIPO SANGU√çNEO DA M√ÉE DISPON√çVEL?"):
	c1, c2 = st.columns(2)
	with c1:
		bgmom = st.radio("TIPO:", ["O", "A", "B", "AB"], key="radio1", horizontal=True)
	with c2:
		rhmom = st.radio("Rh:", ["POSITIVO", "NEGATIVO"], key="radio2", horizontal=True)
		if rhmom == "POSITIVO":
			rhmom = "+"
		else:
			rhmom = "-"
	momBlood = bgmom+rhmom

st.write("SE DUM INCERTA, DEIXAR A DATA DE HOJE")
#LAST MENSTRUAL PERIOD
c1, c2, c3, c4 = st.columns(4)
with c1:
	lmpDate = st.text_input("DUM:", value=date.today().strftime("%d/%m/%Y"))
with c2:
	admDate = st.text_input("DATA ADMISS√ÉO:", value=date.today().strftime("%d/%m/%Y"))
with c3:
	postPartum = st.checkbox("PUERPERA")
with c4:
	usg = st.checkbox("USG DISPON√çVEL")

#LMP GESTATIONAL AGE
gestAgeLmp = daysToIg( nDaysBetween( lmpDate, date.today().strftime("%d/%m/%Y") ) )

#USG
if usg:
	c1, c2, c3, c4, c5 = st.columns([2,1,1,1,2])
	with c1:
		usgDate = st.text_input("DATA USG:", value=date.today().strftime("%d/%m/%Y"))
	with c2:
		st.write("IG NA USG:")
	with c3:
		usgWeeks = st.text_input("SEMANAS:", value="0")
	with c4:
		usgDays = st.text_input("DIAS:", value="0")
	#USG GESTATIONAL AGE
	gestAgeUsg = daysToIg( nDaysBetween( usgDate, date.today().strftime("%d/%m/%Y") ) + igToDays( int(usgWeeks), int(usgDays) ) )

#DEFINES WHICH GESTATIONAL AGE TO USE
if usg:
	if int( usgWeeks ) < 13 and abs( igToDays (gestAgeUsg[0],gestAgeUsg[1]) - igToDays (gestAgeLmp[0],gestAgeLmp[1]) ) > 7:
		gestAge = gestAgeUsg
		modeChosen = "(USG 1¬∫ TRIMESTRE)"
	elif int( usgWeeks ) < 29 and abs( igToDays (gestAgeUsg[0],gestAgeUsg[1]) - igToDays (gestAgeLmp[0],gestAgeLmp[1]) ) > 14:
		gestAge = gestAgeUsg
		modeChosen = "(USG 2¬∫ TRIMESTRE)"
	elif abs( igToDays (gestAgeUsg[0],gestAgeUsg[1]) - igToDays (gestAgeLmp[0],gestAgeLmp[1]) ) > 21:
		gestAge = gestAgeUsg
		modeChosen = "(USG 3¬∫ TRIMESTRE)"
	else:
		gestAge = gestAgeLmp
		modeChosen = "(DUM)"
else:
	gestAge = gestAgeLmp
	modeChosen = "(DUM)"

#LABOR + NEWBORN BLOOD TYPE
if postPartum:
	c1, c2, c3 = st.columns([2,1,1])
	with c1:
		laborMode = st.radio("VIA:", ["VAGINAL", "CES√ÅREA"], key="radio3", horizontal=True)
	with c2:
		laborDate = st.text_input("DATA:", value=date.today().strftime("%d/%m/%Y"))
	with c3:
		laborTime = st.text_input("HORA:")
	if st.checkbox("TIPO SANGU√çNEO DO NEONATO DISPON√çVEL?"):
		c4, c5 = st.columns(2)
		with c4:
			bgnb = st.radio("TIPO:", ["O", "A", "B", "AB"], key="radio4", horizontal=True)
		with c5:
			rhnb = st.radio("Rh:", ["POSITIVO", "NEGATIVO"], key="radio5", horizontal=True)
			if rhnb == "POSITIVO":
				rhnb = "+"
			else:
				rhnb = "-"
		nbBlood = bgnb+rhnb

#DIURESIS
#mark: diu, svd, - bh, qt - sne, vm
c1, c2, c3, c4, c5, c6 = st.columns([1,1,1,1,1,1])
with c1:
	svd = st.checkbox("SVD")
with c2:
	diu = st.checkbox("DIURESE", value=svd)
if svd:
	with c3:
		diuQt = st.text_input("ML:")
	with c4:
		bh = st.text_input("BH:")
with c5:
	sne = st.checkbox("SNE")
with c6:
	vm = st.checkbox("VM")

#DIET + NAUSEA
c1, c2, c3 = st.columns([3,1,1])
with c1:
	diet = st.radio("ACEITA√á√ÉO DIETA:", ["SIM", "N√ÉO", "ZERO"], key="radioDiet", horizontal=True)
with c2:
	emesis = st.checkbox("√äMESE")
with c3:
	nausea = st.checkbox("NAUSEA", value=emesis)

#BOWEL MOVEMENTS + OTHER
#ratio: dej: s, flat, n; seda√ß√£o, deambula√ß√£o
c1, c2, c3 = st.columns([3,1,1])
with c1:
	bowel = st.radio("DEJE√á√ïES:", ["SIM", "FLATOS", "N√ÉO"], key="radioBowel", horizontal=True)
with c2:
	walk = st.checkbox("DEAMBULA")
with c3:
	sed = st.checkbox("SEDA√á√ÉO")

#VITAL SIGNS
#box: pa, fc, spo, fr, gcs, o2, dva
c1, c2, c3, c4, c5, c6, c7, c8, c9 = st.columns(9)
with c1:
	pa = st.text_input("PA:")
with c2:
	fc = st.text_input("FC:")
with c3:
	spo2 = st.text_input("SpO2:")
with c4:
	fr = st.text_input("FR:")
with c7:
	gcs = st.text_input("GCS:", value="15")
with c8:
	o2 = st.checkbox("O2", value=vm)
with c9:
	dva = st.checkbox("DVA")

st.write("EM CASO DE P√ìS PARTO, COLOCAR VALORES NEGATIVOS NA AFU SE ABAIXO DA CICATRIZ UMBILICAL")

#FETAL VITAL SIGNS
#fetus: bcf, afu, du, mov. fetal
if not postPartum:
	c1, c2, c3, c4 = st.columns([1,1,1,4])
	with c1:
		afu = round(float(st.text_input("AFU:", value = "0")), 1)
	with c2:
		bcf = st.text_input("BCF:")
	with c3:
		du = st.checkbox("DU")
	with c4:
		movFet = st.checkbox("MOV. FETAL")
else:
	c1, c2, c3 = st.columns([1,2,4])
	with c1:
		afu = round(float(st.text_input("AFU:", value = "0")), 1)
	with c2:
		milk = st.checkbox("AMAMENTA√á√ÉO")

#box+: eminencia, >fio2, pinsp, peep,< ou >qtO2<
if preec:
	severitySigns = st.checkbox("SINAIS DE IMIN√äNCIA DE ECL√ÇMPSIA")


#PHYSICAL EXAM
ect = st.text_input("ECTOSCOPIA:", value="EG BOM, CONSCIENTE E ORIENTADA, EUPNEICA, NORMOCORADA, HIDRATADA, ACIAN√ìTICA, ANICT√âRICA, AFEBRIL.")
mamas = st.text_input("MAMAS:", value="MAMAS FL√ÅCIDAS, SEM FISSURAS OU SINAIS FLOG√çSTICOS.")
cv = st.text_input("CARDIOVASCULAR:", value=f"RITMO CARD√çACO REGULAR EM 2 TEMPOS, BULHAS NORMOFON√âTICAS, SEM SOPROS, CLIQUES OU ESTALIDOS. PA: {pa} MMHG | FC: {fc} BPM")
ap = st.text_input("PULMONAR:", value=f"MURM√öRIO VESICULAR PRESENTE EM AMBOS HEMIT√ìRAX, SEM RU√çDOS ADVENT√çCIOS. SpO2: {spo2}% | FR: {fr} IRPM")
if postPartum:
	abdVal = f"SEMIGLOBOSO, RU√çDOS HIDROA√âREOS PRESENTES, DEPRESS√çVEL, DOLOROSO √Ä PALPA√á√ÉO PROFUNDA EM REGI√ÉO SUPRAP√öBICA, SEM SINAIS DE IRRITA√á√ÉO PERITONEAL, √öTERO CONTRA√çDO "
	if afu > 0:
		abdVal += f"{afu} CM ACIMA DA CICATRIZ UMBILICAL."
	elif afu < 0:
		afu *= -1
		abdVal += f"{afu} CM ABAIXO DA CICATRIZ UMBILICAL."
	else:
		abdVal += f"NO N√çVEL DA CICATRIZ UMBILICAL."
else:
	abdVal = f"GRAV√çDICO, RU√çDOS HIDROA√âREOS PRESENTES, SEM DOR √Ä PALPA√á√ÉO, T√îNUS UTERINO FISIOL√ìGICO, DIN√ÇMICA UTERINA "
	abdVal += "PRESENTE. " if du else "AUSENTE. "
	abdVal += "MOVIMENTA√á√ïES FETAIS "
	abdVal += "PRESENTES." if movFet else "AUSENTES."
	abdVal += f" BCF: {bcf} BPM | AFU: {afu} CM"
abd = st.text_input("ABDOME:", value=abdVal)
neur = st.text_input("NEUROL√ìGICO:", value=f"GLASGOW {gcs}, SEM SINAIS DE D√âFICITS NEUROL√ìGICOS FOCAIS.")
if postPartum:
	if laborMode == "CES√ÅREA":
		fo = st.text_input("FO:", value="FERIDA OPERAT√ìRIA LIMPA E SEM SINAIS FLOG√çSTICOS.")
	loq = st.text_input("LOQUIOS:", value="RUBROS, SEM ODOR, EM PEQUENA QUANTIDADE.")
else:
	tv = st.text_input("TV:", value="TOQUE VAGINAL N√ÉO REALIZADO.")
ext = st.text_input("EXTREMIDADES:", value="EDEMA (+1/+4) EM MMII. TEC <3S. SEM SINAIS DE TROMBOSE. PULSOS PRESENTES E SIM√âTRICOS.")

#HYPOTHESIS
if postPartum:
	hypothesis = f"1. PUERP√âRIO IMEDIATO DE PARTO {laborMode} REALIZADO DIA {laborDate} √ÄS {laborTime}"
else:
	hypothesis = f"1. GESTA√á√ÉO √öNICA T√ìPICA"
	if gestAge[0] < 34:
		hypothesis += f" PR√â-TERMO "
	elif gestAge[0] < 37:
		hypothesis += f" PR√â-TERMO TARDIO "
	elif gestAge[0] < 41:
		hypothesis += f" TERMO "
	elif gestAge[0] < 42:
		hypothesis += f" TERMO TARDIO "
	else:
		hypothesis += f" P√ìS-TERMO "
	hypothesis += f"COM {gestAge[0]}S {gestAge[1]}D {modeChosen}"
	
hypothesis += f"\n. INCOMPATIBILIDADE SANGU√çNEA MATERNO-FETAL" if (rhmom == "+" and rhnb == "-") else ""
if dm:	
	hypothesis += f"\n. DIABETES MELLITUS {dmType}"	
if crhyp:
	hypothesis += f"\n. HAS CR√îNICA"
if gesthyp:
	if preec:
		hypothesis += f"\n. PR√â-ECL√ÇMPSIA"
		if crhyp:
			hypothesis += f" SOBREPOSTA"
		hypothesis += f" COM SINAIS DE DETERIORA√á√ÉO CL√çNICA" if severePreec else ""
	else:
		hypothesis += f"\n. HAS GESTACIONAL"
hypothesis += f"\n. TR S√çFILIS REAGENTE" if sif else ""
hypothesis += f"\n. TR HIV REAGENTE" if hiv else ""
hypothesis += f"\n. TR HCV REAGENTE" if hcv else ""
hypothesis += f"\n. TR HbsAg REAGENTE" if hbs else ""

#HISTORY
history = f"PACIENTE, G{g}P"
history += str(int(pv)+int(pc)-1) if postPartum else str(int(pv)+int(pc))
gestAgeAdm = daysToIg( igToDays(gestAge[0], gestAge[1]) - nDaysBetween( admDate, date.today().strftime("%d/%m/%Y") ) )
history += f"A{a}, EM CURSO DE IG: {gestAgeAdm[0]}S {gestAgeAdm[1]}D {modeChosen}, DEU ENTRADA NESTE SERVI√áO DIA {admDate}, DEVIDO ________.AO EXAME FISICO ADMISSIONAL, APRESENTAVA-SE COM ________. PACIENTE FOI INTERNADA PARA ________."
if postPartum:
	history += f"PARTO {laborMode} REALIZADO EM {laborDate} √ÄS {laborTime} COM RETIRADA DE FETO VIVO, CEFALICO, _[SEXO]_, APGAR __, PESO ____G."
history += f"ENCAMINHADA PARA _[ALA]_. SEGUE AOS CUIDADOS DA EQUIPE."

#MEDICAL HISTORY
pHist = f"DIABETES MELLITUS {dmType}" if dm and dmType != "GESTACIONAL" else "NEGA DM PR√â-GESTACIONAL"
pHist += f". HAS CR√îNICA." if crhyp else ". NEGA HAS CR√îNICA."
pHist += " NEGA TRANSFUS√ïES. NEGA ETILISMO E TABAGISMO."

#PROGRESS SECTION
prog = "PACIENTE HEMODINAMICAMENTE EST√ÅVEL, "
if vm:
	prog += "EM USO DE VENTILA√á√ÉO MEC√ÇNICA (MODO: ; PINSP/VOL: ; FIO2: ; PEEP: )."
elif o2:
	prog += "EM USO DE ______ (__ L/MIN)."
else:
	prog += "RESPIRANDO EM AR AMBIENTE, SEM DESCONFORTO RESPIRAT√ìRIO. "
prog += "SEM USO DE DROGA VASOATIVA. " if not dva else "EM USO DE ____ (__/MIN). "
prog += "SEM SEDA√á√ÉO. " if not sed else "SEDADA COM ____. "
if svd:
	prog += f"DIURESE EM SVD ({diuQt} ML/24H; BH: {bh}). "
else:
	if diu:
		prog += f"DIURESE PRESENTE. "
	else:
		prog += f"DIURESE AUSENTE. "
if bowel == "SIM":
	prog += f"DEJE√á√ïES E FLATOS PRESENTES. "
else:
	if bowel == "FLATOS":
		prog += f"DEJE√á√ïES AUSENTES (FLATOS PRESENTES). "
	else:
		prog += f"DEJE√á√ïES AUSENTES. "	
if sne:
	if diet == "ZERO":
		prog += f"EM USO DE SNE, DIETA ZERO. "
	elif diet == "SIM":
		prog += f"EM USO DE SNE, SEM RETORNOS. "
	else:
		prog += f"EM USO DE SNE, COM RETORNO DE ____ML. "
else:
	if diet == "ZERO":
		prog += f"EM DIETA ZERO. "
	elif diet == "SIM":
		prog += f"BOA ACEITA√á√ÉO DE DIETA VIA ORAL. "
	else:
		prog += f"ACEITA√á√ÉO RUIM DE DIETA VIA ORAL. "
if emesis:
	prog += f"APRESENTA √äMESE (_ EPIS√ìDIOS). "
elif nausea:
	prog += f"APRESENTA N√ÅUSEAS. "
else:
	prog += f"NEGA NAUSEA E V√îMITOS. "
if walk:
	prog += f"DEAMBULA SEM DIFICULDADES. "
else:
	prog += f"SEM DEAMBULAR. "
if postPartum:
	if milk:
		prog += f"AMAMENTANDO. "
	else:
		prog += f"SEM AMAMENTAR, [MOTIVO]. "
else:
	prog += f"NEGA PERDA DE L√çQUIDO E SANGRAMENTO. NEGA SINTOMAS URIN√ÅRIOS. "
prog += f"NEGA OUTRAS QUEIXAS. "
if preec:
	prog += " RELATA SINAIS DE IMIN√äNCIA DE ECL√ÇMPSIA: [SINAL]." if severitySigns else " NEGA SINAIS DE IMIN√äNCIA DE ECL√ÇMPSIA."

#PHYSICAL EXAM
exFis = "ECTOSCOPIA: "+ect+"\n"
exFis += "MAMAS: "+mamas+"\n"
exFis += "CV: "+cv+"\n"
exFis += "AP: "+ap+"\n"
exFis += "ABDOME: "+abd+"\n"
exFis += "NEUR: "+neur+"\n"
if postPartum:
	if laborMode == "CES√ÅREA":
		exFis += "FO: "+fo+"\n"
	exFis += "LOQUIOS: "+loq+"\n"
else:
	exFis += "TV: "+tv+"\n"
exFis += "EXTREMIDADES: "+ext+"\n"

#TEXT AREAS
hd = st.text_area("Hip√≥teses diagn√≥sticas:", value=hypothesis)
hda = st.text_area("Hist√≥ria da doen√ßa atual:", height=300, value=history)
ap = st.text_area("Antecedentes pessoais:", value=pHist)
evol = st.text_area("Evolu√ß√£o:", height = 200, value=prog)

string = f"ID: {name}, {age} ANOS, G{g} PV{pv} PC{pc} A{a}\nADM HDM: {admDate};\n"
if not postPartum:
	string += f"IG[DUM]: {gestAgeLmp[0]}S {gestAgeLmp[1]}D;" if igToDays (gestAgeLmp[0],gestAgeLmp[1]) > 0 else "IG[DUM]: N√ÉO SABE INFORMAR;"
	string += f" IG[USG]: {gestAgeUsg[0]}S {gestAgeUsg[1]}D;\n" if usg else "\n"
string += f"TS[M√ÉE]: {momBlood} | TS[NEONATO]: {nbBlood}\n(TESTES R√ÅPIDOS) S√çFILIS: "
string += "REAGENTE" if sif else "NR"
string += " |  HIV: "
string += "REAGENTE" if hiv else "NR"
string += " |  HCV: "
string += "REAGENTE" if hcv else "NR"
string += " |  HbsAg: "
string += "REAGENTE" if hbs else "NR"
string += ";\n\n"
string += "#HD:\n"
string += hd
string += "\n\n#HDA: "
string += hda
string += "\n\n#CPN: X CONSULTAS [SEM ALTERA√á√ïES PRESS√ìRICAS/COM ALTERA√á√ïES PRESS√ìRICAS A PARTIR DE XX SEMANAS]. GJ: ; TOTG: (JEJUM)| (1H)| (2H). SOROLOGIAS: NR."
string += "\n\n#AP: "
string += ap
string += "\n\n#EM USO:\n\n#FEZ USO:\n\n#DADOS DA ENFERMAGEM:\nPA: X | X | X | X MMHG\nTAX:  |  |  |  ¬∫C\nFC:  |  |  |  BPM\nBCF:  |  |  |  BPM"
string += "\n\n#EVOLU√á√ÉO: "
string += evol
string += "\n\n#EXAME F√çSICO:\n"
string += exFis
string += "\n#EXAMES COMPLEMENTARES:\n-LABORAT√ìRIO:\n\n-IMAGEM:\n\n#PROGRAMA√á√ÉO:\n"
string += "\n#CONDUTA:\n"

string = string.upper()
st.subheader("üßæ EVOLU√á√ÉO:")
st.text_area("TEXTO:", height = 500, value = string)
